# ESP32 Rust Development Environment

A Nix-based development environment for ESP32 Rust projects. Uses the official [esp-rs/esp-idf-template](https://github.com/esp-rs/esp-idf-template) for project generation, ensuring version compatibility is maintained by the esp-rs team.

## Quick Start

```bash
nix develop                  # Enter development shell
just init my_project         # Generate Rust project (interactive)
just setup                   # Install ESP toolchain (one-time)
# Restart shell to pick up toolchain
just build                   # Compile
just flash                   # Flash to device and monitor
```

## What This Template Provides

This template provides the development environment and conveniences:

| File | Purpose |
|------|---------|
| `flake.nix` | Nix dev shell with system dependencies |
| `.envrc` | Direnv integration for auto-loading |
| `justfile` | Convenience commands |
| `partitions.csv` | Flash partition layout |
| `.env.example` | Template for WiFi/MQTT secrets |

The actual Rust project files (`Cargo.toml`, `src/`, `.cargo/`, etc.) are generated by running `just init`, which uses the official esp-rs template. This ensures dependency versions stay compatible with ESP-IDF.

## Commands

| Command | Description |
|---------|-------------|
| `just init <name>` | Generate Rust project using esp-rs template |
| `just setup` | Install ESP toolchain |
| `just build` | Debug build |
| `just build-release` | Release build (size-optimized) |
| `just flash` | Flash and monitor |
| `just flash-only` | Flash without monitor |
| `just monitor` | Serial monitor only |
| `just clean` | Remove build artifacts |
| `just clean-all` | Remove build artifacts and ESP-IDF cache |
| `just size` | Show binary size breakdown |

## Configuration

### Target Selection

When running `just init`, you'll be prompted to select your target chip (ESP32, ESP32-S3, ESP32-C3, etc.). The template handles the configuration automatically.

### Environment Variables

Copy `.env.example` to `.env` for compile-time configuration (WiFi credentials, etc.):

```bash
cp .env.example .env
```

### Flash Partitions

`partitions.csv` defines the flash layout. Adjust sizes based on your needs and flash size.

## Using as a GitHub Template

1. On GitHub, go to repository **Settings** > **General**
2. Check **Template repository**

Then create new projects via:
- GitHub UI: Click **Use this template**
- CLI: `gh repo create my-project --template USERNAME/esp32_template --clone`

After creating, run `just init <name>` to generate the Rust project.
